<div class="perfil-container">
  <main class="perfil-main">
    <div class="perfil-content">
      <!-- Banner superior -->
      <section class="banner-superior">
        <div class="banner-content">
          <div class="bienvenida">
            <h1>¡Hola, {{ usuario.nombre || 'Cargando' }}!</h1>
            <p class="bienvenida-subtitle">Gestiona tu cuenta desde el panel de control</p>
          </div>

          <div class="acciones-rapidas">
            <button
              class="btn-accion btn-accion-primary btn-glow-effect"
              [routerLink]="['/publicar_producto']"
              *ngIf="puedePublicarProductos"
            >
              <span class="material-icons btn-icon">inventory_2</span>
              <span>Publicar Producto</span>
            </button>
            <button class="btn-accion btn-accion-secondary btn-glow-effect" [routerLink]="['/historial_compras']">
              <span class="material-icons btn-icon">history</span>
              <span>Historial de Compras</span>
            </button>
          </div>
        </div>

        <!-- Tarjetas de estadísticas -->
        <div class="estadisticas-grid">
          <div class="estadistica-card">
            <div class="estadistica-icon estadistica-icon-1">
              <i class="material-icons">local_shipping</i>
            </div>
            <div class="estadistica-info">
              <span class="numero">5</span>
              <span class="label">Pedidos Activos</span>
            </div>
          </div>

          <div class="estadistica-card">
            <div class="estadistica-icon estadistica-icon-2">
              <i class="material-icons">star</i>
            </div>
            <div class="estadistica-info">
              <span class="numero">12</span>
              <span class="label">Favoritos</span>
            </div>
          </div>

          <div class="estadistica-card">
            <div class="estadistica-icon estadistica-icon-3">
              <i class="material-icons">inventory</i>
            </div>
            <div class="estadistica-info">
              <span class="numero">3</span>
              <span class="label">Productos Publicados</span>
            </div>
          </div>

          <div class="estadistica-card">
            <div class="estadistica-icon estadistica-icon-4">
              <i class="material-icons">credit_card</i>
            </div>
            <div class="estadistica-info">
              <span class="numero">2</span>
              <span class="label">Métodos de Pago</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Panel principal con pestañas -->
      <div class="panel-principal">
        <!-- Navegación por pestañas mejorada -->
        <nav class="tabs-navigation">
          <button
            class="tab-btn"
            [class.active]="tabActiva === 'informacion'"
            (click)="cambiarTab('informacion')"
          >
            <i class="material-icons">person</i>
            Información Personal
          </button>
          <button
            class="tab-btn"
            [class.active]="tabActiva === 'direcciones'"
            (click)="cambiarTab('direcciones')"
          >
            <i class="material-icons">location_on</i>
            Direcciones
          </button>
          <button
            class="tab-btn"
            [class.active]="tabActiva === 'productos'"
            (click)="cambiarTab('productos')"
          >
            <i class="material-icons">package</i>
            Mis Productos
          </button>
          <button
            class="tab-btn"
            [class.active]="tabActiva === 'seguridad'"
            (click)="cambiarTab('seguridad')"
          >
            <i class="material-icons">security</i>
            Seguridad
          </button>
        </nav>

        <!-- Contenido de pestañas -->
        <div class="tabs-content">
          <!-- Pestaña: Información Personal -->
          <div *ngIf="tabActiva === 'informacion'" class="tab-pane">
            <div class="pane-header">
              <h2><i class="material-icons">person</i> Información Personal</h2>
              <div class="pane-acciones">
                <button class="btn-secundario btn-logout" (click)="cerrarSesion()">
                  <i class="material-icons">logout</i> Cerrar Sesión
                </button>
                <button class="btn-editar btn-glow-effect" (click)="toggleEdicion()">
                  <i class="material-icons">{{ editando ? 'close' : 'edit' }}</i>
                  {{ editando ? 'Cancelar' : 'Editar Perfil' }}
                </button>
              </div>
            </div>

            <div class="formulario-perfil">
              <div class="form-grid">
                <div class="form-group">
                  <label for="nombre">Nombre completo *</label>
                  <div *ngIf="!editando" class="info-display">{{ usuario.nombre }}</div>
                  <input
                    *ngIf="editando"
                    id="nombre"
                    type="text"
                    [(ngModel)]="usuarioEditado.nombre"
                    class="form-input"
                    placeholder="Nombre completo"
                  />
                </div>

                <div class="form-group">
                  <label for="curp">CURP *</label>
                  <div *ngIf="!editando" class="info-display">{{ usuario.curp }}</div>
                  <input
                    *ngIf="editando"
                    id="curp"
                    type="text"
                    [(ngModel)]="usuarioEditado.curp"
                    class="form-input"
                    placeholder="ABCD123456HEMLMN09"
                    maxlength="18"
                  />
                </div>

                <div class="form-group">
                  <label for="email">Correo electrónico *</label>
                  <div *ngIf="!editando" class="info-display">{{ usuario.email }}</div>
                  <input
                    *ngIf="editando"
                    id="email"
                    type="email"
                    [(ngModel)]="usuarioEditado.email"
                    class="form-input"
                    placeholder="correo@ejemplo.com"
                  />
                </div>

                <div class="form-group">
                  <label for="telefono">Teléfono *</label>
                  <div *ngIf="!editando" class="info-display">{{ usuario.telefono }}</div>
                  <input
                    *ngIf="editando"
                    id="telefono"
                    type="tel"
                    [(ngModel)]="usuarioEditado.telefono"
                    class="form-input"
                    placeholder="+52 55 1234 5678"
                  />
                </div>

                <div class="form-group full-width">
                  <label for="fechaNacimiento">Fecha de nacimiento</label>
                  <div *ngIf="!editando" class="info-display">
                    {{ usuario.fechaNacimiento | date: 'longDate' }}
                  </div>
                  <input
                    *ngIf="editando"
                    id="fechaNacimiento"
                    type="date"
                    [(ngModel)]="usuarioEditado.fechaNacimiento"
                    class="form-input"
                  />
                </div>
              </div>

              <!-- Acciones del formulario -->
              <div *ngIf="editando" class="form-actions">
                <button class="btn-guardar btn-glow-effect" (click)="guardarCambios()">
                  <i class="material-icons">save</i> Guardar Cambios
                </button>
                <button class="btn-cancelar" (click)="toggleEdicion()">Cancelar</button>
              </div>
            </div>
          </div>

          <!-- Pestaña: Direcciones -->
          <div *ngIf="tabActiva === 'direcciones'" class="tab-pane">
            <div class="pane-header">
              <h2><i class="material-icons">location_on</i> Mis Direcciones</h2>
              <div class="pane-acciones">
                <button class="btn-secundario btn-logout" (click)="cerrarSesion()">
                  <i class="material-icons">logout</i> Cerrar Sesión
                </button>
                <button class="btn-primary btn-glow-effect" (click)="agregarDireccion()">
                  <i class="material-icons">add</i> Agregar Dirección
                </button>
              </div>
            </div>

            <div class="direcciones-grid">
              <div *ngFor="let direccion of direcciones; let i = index" class="direccion-card">
                <div class="direccion-header">
                  <div class="direccion-titulo">
                    <h3>{{ direccion.nombre }}</h3>
                    <span *ngIf="direccion.principal" class="badge-principal">
                      <i class="material-icons">check_circle</i> Principal
                    </span>
                  </div>
                  <div class="direccion-acciones">
                    <button class="btn-icon" (click)="editarDireccion(i)" title="Editar">
                      <i class="material-icons">edit</i>
                    </button>
                    <button class="btn-icon" (click)="eliminarDireccion(i)" title="Eliminar">
                      <i class="material-icons">delete</i>
                    </button>
                  </div>
                </div>

                <div class="direccion-info">
                  <p><strong>Dirección:</strong> {{ direccion.calle }}, {{ direccion.colonia }}</p>
                  <p><strong>Ciudad:</strong> {{ direccion.ciudad }}, {{ direccion.estado }}</p>
                  <p><strong>C.P.:</strong> {{ direccion.codigoPostal }}</p>
                  <p><strong>Entre calles:</strong> {{ direccion.entreCalles }}</p>
                  <p><strong>Instrucciones:</strong> {{ direccion.instrucciones }}</p>
                </div>

                <div class="direccion-footer">
                  <button
                    *ngIf="!direccion.principal"
                    class="btn-secundario"
                    (click)="establecerPrincipal(i)"
                  >
                    Establecer como principal
                  </button>
                </div>
              </div>
            </div>

            <div *ngIf="direcciones.length === 0" class="sin-direcciones">
              <i class="material-icons icon-large">location_off</i>
              <h3>No hay direcciones guardadas</h3>
              <p>Agrega una dirección para recibir tus pedidos</p>
              <button class="btn-primary btn-glow-effect" (click)="agregarDireccion()">
                <i class="material-icons">add</i> Agregar primera dirección
              </button>
            </div>
          </div>

          <!-- Pestaña: Mis Productos -->
          <div *ngIf="tabActiva === 'productos'" class="tab-pane">
            <div class="pane-header">
              <h2><i class="material-icons">package</i> Mis Productos</h2>
              <div class="pane-acciones">
                <button class="btn-secundario btn-logout" (click)="cerrarSesion()">
                  <i class="material-icons">logout</i> Cerrar Sesión
                </button>
                <button
                  class="btn-primary btn-glow-effect"
                  [routerLink]="['/publicar_producto']"
                  *ngIf="puedePublicarProductos"
                >
                  <i class="material-icons">add</i> Publicar Nuevo Producto
                </button>
              </div>
            </div>

            <!-- Mensaje si NO es vendedor aprobado -->
            <div *ngIf="!puedePublicarProductos" class="alerta-vendedor">
              <div class="alerta-icon"><i class="material-icons">warning</i></div>
              <div class="alerta-content">
                <h3>Acceso restringido</h3>
                <p *ngIf="estadoSolicitud === null">
                  Necesitas ser vendedor verificado para publicar productos.
                  <a routerLink="/vendedor" class="link-vendedor">Enviar solicitud de vendedor</a>
                </p>
                <p *ngIf="estadoSolicitud === 'pending'">
                  Tu solicitud de vendedor está siendo revisada. Te notificaremos pronto.
                </p>
                <p *ngIf="estadoSolicitud === 'rejected'">
                  Tu solicitud de vendedor fue rechazada. Puedes intentar nuevamente.
                  <a routerLink="/vendedor" class="link-vendedor">Enviar nueva solicitud</a>
                </p>
              </div>
            </div>

            <!-- Filtros de productos -->
            <div class="productos-filtros" *ngIf="puedePublicarProductos">
              <div class="filtros-group">
                <button class="filtro-btn active">Todos</button>
                <button class="filtro-btn">Activos</button>
                <button class="filtro-btn">Pausados</button>
                <button class="filtro-btn">Vendidos</button>
              </div>
              <div class="busqueda-productos">
                <input type="text" placeholder="Buscar producto..." class="search-input" />
                <button class="btn-icon">
                  <i class="material-icons">search</i>
                </button>
              </div>
            </div>

            <!-- Lista de productos -->
            <div class="productos-grid" *ngIf="puedePublicarProductos">
              <div *ngFor="let producto of productos; let i = index" class="producto-card">
                <div class="producto-imagen">
                  <img [src]="producto.imagen" [alt]="producto.nombre" />
                  <span class="producto-estado" [class]="producto.estado">
                    {{
                      producto.estado === 'activo'
                        ? 'Activo'
                        : producto.estado === 'pausado'
                          ? 'Pausado'
                          : 'Vendido'
                    }}
                  </span>
                </div>

                <div class="producto-info">
                  <h3>{{ producto.nombre }}</h3>
                  <p class="producto-descripcion">{{ producto.descripcion }}</p>
                  <div class="producto-detalles">
                    <span class="producto-precio">${{ producto.precio | number }}</span>
                    <span class="producto-stock">
                      <i class="material-icons">inventory</i> {{ producto.stock }} disponibles
                    </span>
                    <span class="producto-visitas">
                      <i class="material-icons">visibility</i> {{ producto.visitas }} vistas
                    </span>
                  </div>
                </div>

                <div class="producto-acciones">
                  <button
                    class="btn-icon btn-icon-warning"
                    (click)="editarProducto(i)"
                    title="Editar"
                  >
                    <i class="material-icons">edit</i>
                  </button>
                  <button
                    class="btn-icon btn-icon-info"
                    (click)="pausarProducto(i)"
                    [title]="producto.estado === 'activo' ? 'Pausar' : 'Activar'"
                  >
                    <i class="material-icons">{{ producto.estado === 'activo' ? 'pause' : 'play_arrow' }}</i>
                  </button>
                  <button
                    class="btn-icon btn-icon-danger"
                    (click)="eliminarProducto(i)"
                    title="Eliminar"
                  >
                    <i class="material-icons">delete</i>
                  </button>
                </div>
              </div>
            </div>

            <div *ngIf="puedePublicarProductos && productos.length === 0" class="sin-productos">
              <i class="material-icons icon-large">inventory_2</i>
              <h3>No hay productos publicados</h3>
              <p>Comienza a publicar tus productos para vender en la plataforma</p>
              <button class="btn-primary btn-glow-effect" [routerLink]="['/publicar_producto']">
                <i class="material-icons">add</i> Publicar primer producto
              </button>
            </div>
          </div>

          <!-- Pestaña: Seguridad -->
          <div *ngIf="tabActiva === 'seguridad'" class="tab-pane">
            <div class="pane-header">
              <h2><i class="material-icons">security</i> Seguridad y Privacidad</h2>
              <div class="pane-acciones">
                <button class="btn-secundario btn-logout" (click)="cerrarSesion()">
                  <i class="material-icons">logout</i> Cerrar Sesión
                </button>
              </div>
            </div>

            <div class="configuraciones-list">
              <div class="config-item">
                <div class="config-info">
                  <h3><i class="material-icons">lock</i> Cambiar Contraseña</h3>
                  <p>Actualiza tu contraseña regularmente para mantener tu cuenta segura</p>
                </div>
                <button class="btn-primary btn-password btn-glow-effect" (click)="cambiarContrasena()">
                  <i class="material-icons">key</i> Cambiar Contraseña
                </button>
              </div>

              <div class="config-item">
                <div class="config-info">
                  <h3><i class="material-icons">verified_user</i> Verificación en dos pasos</h3>
                  <p>Añade una capa extra de seguridad a tu cuenta</p>
                </div>
                <label class="toggle-switch">
                  <input
                    type="checkbox"
                    [(ngModel)]="verificacionDosPasos"
                    id="verificacionDosPasos"
                  />
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="config-item">
                <div class="config-info">
                  <h3><i class="material-icons">notifications</i> Notificaciones</h3>
                  <p>Configura cómo recibir notificaciones sobre tus actividades</p>
                </div>
                <div class="notificaciones-opciones">
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      [(ngModel)]="notificacionesEmail"
                      id="notificacionesEmail"
                    />
                    <span class="checkmark"></span>
                    Correo electrónico
                  </label>
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      [(ngModel)]="notificacionesPush"
                      id="notificacionesPush"
                    />
                    <span class="checkmark"></span>
                    Notificaciones push
                  </label>
                </div>
              </div>

              <div class="config-item danger">
                <div class="config-info">
                  <h3><i class="material-icons">warning</i> Eliminar cuenta</h3>
                  <p>Elimina permanentemente tu cuenta y todos tus datos</p>
                </div>
                <button class="btn-danger" (click)="eliminarCuenta()">
                  <i class="material-icons">delete_forever</i> Eliminar Cuenta
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>